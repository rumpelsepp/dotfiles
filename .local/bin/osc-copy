#!/usr/bin/env python3

import argparse
import base64
import os
import sys


def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument("text", nargs="?", help="Text to copy")
    return parser.parse_args()


def osc52_copy(data: bytes):
    data_enc = base64.b64encode(data)
    if "TMUX" in os.environ:
        buf = b"\033Ptmux;\033\033]52;c;" + data_enc + b"\a\033\\"
    else:
        buf = b"\033]52;c;" + data_enc + b"\a"
    sys.stdout.buffer.write(buf)


def main():
    args = parse_args()
    data = args.text.encode() if args.text else sys.stdin.buffer.read()
    osc52_copy(data)


if __name__ == "__main__":
    main()
