#!/usr/bin/env bash

# TODO: Implement this!
# CONFIG="$HOME/.config/autocommitter.conf"
# if [[ -f $CONFIG ]]; then
#     source $CONFIG
# fi

# TODO: Replace this with values from config.
REPO="$HOME/Documents"

# Returns "*" if the current git branch is dirty.
# see: http://stackoverflow.com/a/2658301/2587286
evil_git_dirty() {
    [[ -n "$(git status --porcelain 2> /dev/null)" ]] && echo "*"
}

# Returns the number of untracked files
# see: http://stackoverflow.com/a/2658301/2587286
evil_git_num_untracked_files() {
    expr `git status --porcelain 2>/dev/null| grep "^??" | wc -l`
}


if [[ ! -d $REPO ]]; then
    echo "$REPO does not exist!"
    exit 1
fi

cd $REPO

if [[ $(evil_git_dirty) == "*" ]]; then
    git add .

    # see: http://stackoverflow.com/a/29130100/2587286
    status=$(git status --porcelain)
    modified=$(printf "$status" | grep -c '^[MR]')
    added=$(printf "$status" | grep -c '^A')
    deleted=$(printf "$status" | grep -c '^D')
    commitmsg=$(printf "[autocommitter] %d modified, %d added, %d deleted" "$modified" "$added" "$deleted")

    git commit -m "$commitmsg"
else
    echo "Nothing to commit"
fi
